{"version":3,"sources":["../src/FormControl.jsx"],"names":["schemas","methods","props","classNames","values","fields","Object","keys","forEach","name","className","static","value","state","validator","addMethods","handleChange","nextProps","newValue","assembleFieldValidate","setState","schema","validateByField","result","error","classNameArray","success","filter","item","join","message","undefined","isValid","names","validateField","validateFieldsByNames","isAllValid","formValues","operateChange","validate","validateByNames","addFields","removeFields","addSchemas","removeSchemas","every","childContextTypes","object","isRequired","func","propTypes","defaultProps","e","target","type","theValue","slice","index","indexOf","push","splice","newFields","validateFieldsAll"],"mappings":"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","file":"FormControl.js","sourcesContent":["/**\n * A lightweight and extensible React validation component\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport Validator from 'validate-framework-utils';\n\n/**\n * React validation component\n * @param schemas\n * @param methods Extended Validation Method\n * @return Component\n */\nexport default (schemas, methods) => FormComponent => (\n\n  /**\n   * Returns a react form\n   */\n  class FormControl extends Component {\n\n    static childContextTypes = {\n      fields: PropTypes.object.isRequired,\n      handleChange: PropTypes.func.isRequired,\n    };\n\n    static propTypes = {\n      values: PropTypes.object.isRequired,\n      classNames: PropTypes.object,\n    };\n\n    static defaultProps = {\n      classNames: {},\n    };\n\n    constructor(props) {\n      super(props);\n      const { classNames, values } = props;\n\n      // Assemble the initialization data into fields\n      const fields = {};\n      Object.keys(values).forEach((name) => {\n        fields[name] = {\n          className: classNames.static,\n          value: values[name],\n        };\n      });\n\n      this.state = {\n        fields,\n      };\n\n      // Initializes the validation component and customizes the validation method\n      this.validator = new Validator().addMethods(methods);\n    }\n\n    getChildContext() {\n      return {\n        fields: this.state.fields,\n        handleChange: this.handleChange,\n      };\n    }\n\n    componentWillReceiveProps(nextProps) {\n      // Updates the state from the parent component\n      const { values } = nextProps;\n      const { classNames } = this.props;\n      const { fields } = this.state;\n\n      Object.keys(values).forEach((name) => {\n        const newValue = values[name];\n        // Validate the new data\n        if (fields[name]) {\n          // diff\n          if (fields[name].value !== newValue) {\n            this.assembleFieldValidate(name, newValue);\n          }\n        } else {\n          // Add a new field\n          fields[name] = {\n            className: classNames.static,\n            value: newValue,\n          };\n        }\n      });\n\n      this.setState({\n        fields,\n      });\n    }\n\n    /**\n     * Get the fields object\n     * @returns {Object}\n     */\n    get fields() {\n      return this.state.fields;\n    }\n\n    /**\n     * Gets a list of form values\n     * @return {Object}\n     */\n    get formValues() {\n      const { fields } = this.state;\n      const values = {};\n      Object.keys(fields).forEach((name) => {\n        values[name] = fields[name].value;\n      });\n      return values;\n    }\n\n    /**\n     * Gets the global validation status\n     * @return {Boolean}\n     */\n    get isAllValid() {\n      const { fields } = this.state;\n      return Object.keys(schemas).every(name => fields[name].result);\n    }\n\n    /**\n     * Assemble the data\n     * This method is not operational\n     * @param name\n     * @param value\n     */\n    assembleFieldValidate(name, value) {\n      const { classNames } = this.props;\n      const { fields } = this.state;\n      // No schema is not to validate\n      const schema = schemas[name] && Object.assign(schemas[name], { value });\n      const { result, error } = schema ? this.validator.validateByField(schema) : {};\n      // Assembly class name\n      // Validation success and validation failure Add the appropriate class\n      const classNameArray = [\n        classNames.static,\n        result ? classNames.success : null,\n        result === false ? classNames.error : null,\n      ];\n      // Assemble\n      Object.assign(fields[name], {\n        value,\n        className: classNameArray.filter(item => item).join('\\u{20}'),\n        result,\n        message: error ? error.message : undefined,\n      });\n    }\n\n    /**\n     * Validate a single field\n     * @param name\n     * @param value\n     * @return {Boolean}\n     */\n    validateField(name, value) {\n      const { fields } = this.state;\n      // Assemble\n      this.assembleFieldValidate(name, value);\n      return fields[name].result;\n    }\n\n    /**\n     * Validate fields by names\n     * @param names\n     * @return {Boolean}\n     */\n    validateFieldsByNames(...names) {\n      const { fields } = this.state;\n      let isValid = true;\n      names.forEach((name) => {\n        const result = fields[name] && this.validateField(name, fields[name].value);\n        // Exclude unauthenticated and validated successfully\n        if (result === false) {\n          isValid = false;\n        }\n      });\n      return isValid;\n    }\n\n    /**\n     * Validate all fields\n     * @return {Boolean}\n     */\n    validateFieldsAll() {\n      const names = Object.keys(schemas);\n      return this.validateFieldsByNames(...names);\n    }\n\n    // Form change event listener\n    handleChange = (e) => {\n      const { name, type, value } = e.target;\n      const { fields } = this.state;\n\n      // Dependent on the name attribute\n      if (!name) {\n        return;\n      }\n\n      let theValue;\n      // Checkbox processing\n      if (type === 'checkbox') {\n        theValue = fields[name].value.slice();\n        const index = theValue.indexOf(value);\n        if (index === -1) {\n          theValue.push(value);\n        } else {\n          theValue.splice(index, 1);\n        }\n      } else {\n        theValue = value;\n      }\n\n      // Validate\n      this.validateField(name, theValue);\n\n      // Synchronize values external state\n      this.props.values[name] = theValue;\n      // Update\n      this.setState({\n        fields,\n      });\n    };\n\n    /**\n     * Customize to change the field\n     * @param newFields\n     */\n    operateChange = (...newFields) => {\n      const { fields } = this.state;\n      newFields.forEach((item) => {\n        const { name, value } = item;\n        Object.assign(fields[name], {\n          value,\n        });\n        // Synchronize values external state\n        this.props.values[name] = value;\n        this.validateField(name, value);\n      });\n      // Update\n      this.setState({\n        fields,\n      });\n    };\n\n    /**\n     * Add one or more validation rules\n     * @param schema\n     */\n    addSchemas = (schema) => {\n      Object.assign(schemas, schema);\n    };\n\n    /**\n     * Delete one or more validation rules\n     * @param names\n     */\n    removeSchemas = (...names) => {\n      const { fields } = this.state;\n      names.forEach((name) => {\n        delete schemas[name]; // eslint-disable-line no-param-reassign\n      });\n      // Validate the deleted status\n      this.validateFieldsByNames(...names);\n      // Update\n      this.setState({\n        fields,\n      });\n    };\n\n    /**\n     * Add one or more fields\n     * @param newFields\n     */\n    addFields = (newFields) => {\n      const { classNames } = this.props;\n      const { fields } = this.state;\n      Object.keys(newFields).forEach((name) => {\n        Object.assign(newFields[name], {\n          className: classNames.static,\n        });\n      });\n      Object.assign(fields, newFields);\n      // Update\n      this.setState({\n        fields,\n      });\n    };\n\n    /**\n     * Deletes one or more fields\n     * @param names\n     */\n    removeFields = (...names) => {\n      const { fields } = this.state;\n      names.forEach((name) => {\n        delete fields[name];\n      });\n      // Update\n      this.setState({\n        fields,\n      });\n    };\n\n    /**\n     * Validate the component through names\n     * @param names\n     * @return {Boolean}\n     */\n    validateByNames = (...names) => {\n      const result = this.validateFieldsByNames(...names);\n      const { fields } = this.state;\n      // Update\n      this.setState({\n        fields,\n      });\n      return result;\n    };\n\n    // Validate all\n    validate = () => {\n      // 验证\n      const result = this.validateFieldsAll();\n      const { fields } = this.state;\n      // Update\n      this.setState({\n        fields,\n      });\n      return result;\n    };\n\n    render() {\n      return (\n        <FormComponent\n          {...this.props}\n          fields={this.fields}\n          isAllValid={this.isAllValid}\n          formValues={this.formValues}\n          onChange={this.handleChange}\n          operateChange={this.operateChange}\n          validate={this.validate}\n          validateByNames={this.validateByNames}\n          addFields={this.addFields}\n          removeFields={this.removeFields}\n          addSchemas={this.addSchemas}\n          removeSchemas={this.removeSchemas}\n        />\n      );\n    }\n  }\n);\n"]}